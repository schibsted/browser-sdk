!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.SPiD=t():e.SPiD=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=2)}([function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});t.SDKError=function(e){function t(e){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return s(t,e),t}(Error)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(7),a=r(u),h=n(8),c=r(h),l=n(17),f=n(4),p=n(0),d=r(p),v=n(5),m=r(v),y=n(3),b=r(y),g=function(){function e(t){if(o(this,e),"object"!==(void 0===t?"undefined":s(t)))throw new TypeError("options must be an object but it is "+(void 0===t?"undefined":s(t))+": "+t);if("string"!=typeof t.client_id)throw new TypeError("client_id parameter is required");if("string"!=typeof t.redirect_uri)throw new TypeError("redirect_uri parameter is required");if("string"!=typeof t.serverUrl)throw new TypeError("serverUrl parameter is required");("number"!=typeof t.refresh_timeout||t.refresh_timeout<=6e4)&&(t.refresh_timeout=6e4),this.fetch=c.default,this.options=t,this.event=new a.default,this._sessionInitiatedSent=!1,this._userStatus="unknown",t.cache&&(this.cache=new b.default.InMemoryCache),this._session={},this.persist=this.getPersistenceModule(t.persistence),this.uriBuilder=new m.default.Builder(t.serverUrl,{client_id:t.client_id,redirect_uri:t.redirect_uri}),this.event.emit("initialized")}return i(e,[{key:"getPersistenceModule",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"localstorage",t="spid_js_"+this.options.client_id;switch(e){case"localstorage":return new b.default.WebStoragePersistence(t);case"cookie":return new b.default.CookiePersistence(t);default:return new b.default.NullPersistence}}},{key:"version",value:function(){return l.version}},{key:"clearClientData",value:function(){this.persist.clear(),this.cookie.clearVarnishCookie()}},{key:"acceptAgreement",value:function(){var e=this;return this.fetch(this.uriBuilder.agreement()).then(function(){return e.clearClientData(),e.hasSession()})}},{key:"emitSessionEvent",value:function(e,t){t.visitor&&this.event.emit("SPiD.visitor",t.visitor),t.userId&&e.userId!==t.userId&&this.event.emit("SPiD.login",t),e.userId&&!t.userId&&this.event.emit("SPiD.logout",t),e.userId&&t.userId&&e.userId!==t.userId&&this.event.emit("SPiD.userChange",t),(t.userId||e.userId)&&this.event.emit("SPiD.sessionChange",t),t.userId||e.userId||this.event.emit("SPiD.notLoggedin",t),t.userId&&!this._sessionInitiatedSent&&(this._sessionInitiatedSent=!0,this.event.emit("SPiD.sessionInit",t)),t.userStatus!==this._userStatus&&(this._userStatus=t.userStatus,this.event.emit("SPiD.statusChange",t))}},{key:"hasSession",value:function(){var e=this,t=this.persist.get();if(t)return Promise.resolve(t);this.fetch(this.options.useSessionCluster?this.uriBuilder.sessionCluster(1):this.uriBuilder.session(1)).catch(function(t){if(e.options.useSessionCluster&&t&&"LoginException"===t.type)return e.event.emit("SPiD.loginException"),fetch(e.uriBuilder.session(1));throw new d.default(t)}).then(function(t){(t.result||e.options.cache&&e.options.cache.hasSession)&&e.persist.set(t,t.expiresIn||e.options.cache.hasSessionTTL),e.emitSessionEvent(e._session,t),e._session=t},function(t){return e.event.emit("SPiD.error",t)})}},{key:"hasProduct",value:function(e){var t=this,n="prd_"+e;if(this.cache){var r=this.cache.get(n);return Promise.resolve(r)}return this.fetch(this.uriBuilder.product(e)).then(function(r){r.result&&(t.cache&&t.cache.set(n,r,t.cache.hasProduct),t.event.emit("SPiD.hasProduct",{productId:e,result:r.result}))})}},{key:"hasSubscription",value:function(e){var t=this,n="pub_"+e;if(this.cache){var r=this.cache.get(n);return Promise.resolve(r)}return this.fetch(this.uriBuilder.subscription(e)).then(function(r){r.result&&(t.cache&&t.cache.set(n,r,t.cache.hasSubscription),t.event.emit("SPiD.hasSubscription",{subscriptionId:e,result:r.result}))})}},{key:"setTraits",value:function(e){return this.fetch(this.uriBuilder.traits(e))}},{key:"login",value:function(e){if(this.options.popup){this._lastLoginPopupRef&&this._lastLoginPopupRef.close();var t=(0,f.openPopup)(this.uriBuilder.loginNew(e),"Login");if(t)return this._lastLoginPopupRef=t,(0,f.keepPopupFocused)(t),t}return window.location=this.uriBuilder.loginNew(),window}},{key:"logout",value:function(e){var t=this;return this.fetch(this.uriBuilder.logout(e)).then(function(e){t.clearClientData(),t.event.emit("logout",e)})}}]),e}();t.default=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=function(e){return e&&e.__esModule?e:{default:e}}(r);t.default=o.default},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){if("number"!=typeof e&&(e=Number.parseInt(e,10),!Number.isSafeInteger()))throw new TypeError("Invalid type for relative time: "+e);return c()+e}function s(e){return c()>e}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(6),h=function(e){return e&&e.__esModule?e:{default:e}}(a),c=function(){return 1e3*Date.now()},l=function(e){return new Date(o(e))},f=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"SP_ID";r(this,e),this.key=t}return u(e,[{key:"set",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";h.default.set(this.name,e,{expires:l(t),domain:n})}},{key:"clear",value:function(){h.default.erase(this.key)}}]),e}(),p=function(){function e(){r(this,e)}return u(e,[{key:"get",value:function(){}},{key:"set",value:function(){}},{key:"clear",value:function(){}}]),e}(),d=function(){function e(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];r(this,e),this.key=t,this.shouldThrow=o,n&&(this.varnishCookie=new f)}return u(e,[{key:"get",value:function(){var e=h.default.get(this.key);if(e)try{var t=JSON.parse(unescape(e));return t.expiresIn=parseInt(t.expiresIn,10),t.clientTime=parseInt(t.clientTime,10),t}catch(e){if(this.shouldThrow)throw e;return}}},{key:"set",value:function(e,t){if(!e)return!1;var n=e.baseDomain||"";e.sp_id&&this.varnishCookie&&this.varnishCookie.set(e.sp_id,t,n);try{return h.default.set(this.key,escape(JSON.stringify(e)),{expires:l(t),domain:n}),!0}catch(e){if(this.shouldThrow)throw e;return!1}}},{key:"clear",value:function(){h.default.erase(this.key)}}]),e}(),v=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.localStorage,o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];r(this,e),void 0===n&&window&&window.localStorage&&(n=window.localStorage),this.storage=n,this.key=t,this.shouldThrow=o}return u(e,[{key:"get",value:function(){try{var e=JSON.parse(this.storage.getItem(this.key));return"object"!==(void 0===e?"undefined":i(e))||s(e._expires)?void this.clear():e}catch(e){if(this.shouldThrow)throw e;return}}},{key:"set",value:function(e,t){try{return e._expires=o(t),this.storage.setItem(this.key,JSON.stringify(e)),!0}catch(e){if(this.shouldThrow)throw e;return!1}}},{key:"clear",value:function(){try{return this.storage.removeItem(this.key),!0}catch(e){if(this.shouldThrow)throw e;return!1}}}]),e}(),m=function(){function e(t){r(this,e),this.storage={},this.defaultExpiresIn=t}return u(e,[{key:"get",value:function(e){var t=this.storage[e];return"object"!==(void 0===t?"undefined":i(t))||s(t._expires)?void this.clear(e):t.value}},{key:"set",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.defaultExpiresIn;return this.storage[e]={value:t,_expires:o(n)},!0}},{key:"clear",value:function(e){return delete this.storage[e],!0}},{key:"clearAll",value:function(){var e=this;Object.keys(this.storage).forEach(function(t){return e.clear(t)})}}]),e}();e.exports={CookiePersistence:d,NullPersistence:p,WebStoragePersistence:v,InMemoryCache:m}},function(e,t,n){"use strict";function r(e){var t=setInterval(function(){e.closed?clearInterval(t):(e.focus(),r(e))},300)}function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Schibsted",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:360,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:570,o={width:n,height:r,top:screen.height?(screen.height-r)/2:100,left:screen.width?(screen.width-n)/2:100,scrollbars:"yes",location:"no",directories:"no",status:"no",menubar:"no",toolbar:"no",resizable:"yes"},s=[];return Object.keys(o).forEach(function(e){return s.push(e+"="+o[e])}),window.open(e,t,s.join(","))}Object.defineProperty(t,"__esModule",{value:!0}),t.keepPopupFocused=r,t.openPopup=o},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"LOCAL";if("string"!=typeof e||""===e)throw new a.default('Invalid host: "'+e+'" (should be a non-empty string)');return h[e.toUpperCase()]||e}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(13),u=n(0),a=function(e){return e&&e.__esModule?e:{default:e}}(u),h={LOCAL:"spp.dev",DEV:"identity-dev.schibsted.com",PRE:"identity-pre.schibsted.com",PRO:"payment.schibsted.no","PRO.NO":"payment.schibsted.no","PRO.COM":"payment.schibsted.no"},c=function(){function e(t,n){r(this,e);var o=(0,i.parse)(t),s=o.protocol,u=o.hostname,a=o.port;this._hostname=u,this._protocol=s,this._port=a,this._defaultParams=n}return s(e,[{key:"_build",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=Object.assign({},this._defaultParams,t);return(0,i.format)({protocol:this._protocol,hostname:n+this._hostname,port:this._port,query:r,pathname:e})}},{key:"login",value:function(){return this._build("flow/login",{response_type:"code"})}},{key:"auth",value:function(){return this._build("flow/auth",{response_type:"code"})}},{key:"signup",value:function(){return this._build("flow/signup",{response_type:"code"})}},{key:"logout",value:function(){return this._build("logout",{response_type:"code"})}},{key:"account",value:function(){return this._build("account/summary",{response_type:"code"})}},{key:"purchaseHistory",value:function(){return this._build("account/purchasehistory")}},{key:"subscriptions",value:function(){return this._build("account/subscriptions")}},{key:"products",value:function(){return this._build("account/products")}},{key:"redeem",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this._build("account/summary",{voucher_code:e})}},{key:"purchaseProduct",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this._build("flow/checkout",{response_type:"code",flow:"payment",product_id:e})}},{key:"purchaseCampaign",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._build("flow/checkout",{response_type:"code",flow:"payment",campaign_id:e,product_id:t,voucher_code:n})}},{key:"loginNew",value:function(e){return this._build("bff-oauth/authorize",{response_type:"code",scope:"openid",redirect_uri:e})}},{key:"sessionCluster",value:function(e){return this._build("rpc/hasSession.js",{autologin:e},"session.")}},{key:"session",value:function(e){return this._build("ajax/hasSession.js",{autologin:e})}},{key:"product",value:function(e){return this._build("ajax/hasproduct.js",{product_id:e})}},{key:"subscription",value:function(e){return this._build("ajax/hassubscription.js",{product_id:e})}},{key:"agreement",value:function(){return this._build("ajax/acceptAgreement.js")}},{key:"traits",value:function(e){return this._build("ajax/traits.js",{t:e})}}]),e}();e.exports={normalizeHostname:o,Builder:c}},function(e,t){t.defaults={},t.set=function(e,n,r){var o=r||{},s=t.defaults,i=o.expires||s.expires,u=o.domain||s.domain,a=void 0!==o.path?o.path:void 0!==s.path?s.path:"/",h=void 0!==o.secure?o.secure:s.secure,c=void 0!==o.httponly?o.httponly:s.httponly,l=i?new Date("number"==typeof i?(new Date).getTime()+864e5*i:i):"";document.cookie=e.replace(/[^+#$&^`|]/g,encodeURIComponent).replace("(","%28").replace(")","%29")+"="+n.replace(/[^+#$&\/:<-\[\]-}]/g,encodeURIComponent)+(l&&l.getTime()>=0?";expires="+l.toUTCString():"")+(u?";domain="+u:"")+(a?";path="+a:"")+(h?";secure":"")+(c?";httponly":"")},t.get=function(e){for(var t=document.cookie.split(";"),n=0;n<t.length;n++){var r=t[n],o=r.length,s=r.indexOf("=");s=s<0?o:s;if(decodeURIComponent(r.substring(0,s).replace(/^\s+/,""))===e)return decodeURIComponent(r.substring(s+1,o))}return null},t.erase=function(e,n){t.set(e,"",{expires:-1,domain:n&&n.domain,path:n&&n.path,secure:0,httponly:0})},t.all=function(){for(var e={},t=document.cookie.split(";"),n=0;n<t.length;n++){var r=t[n],o=r.length,s=r.indexOf("=");s=s<0?o:s;e[decodeURIComponent(r.substring(0,s).replace(/^\s+/,""))]=decodeURIComponent(r.substring(s+1,o))}return e}},function(e,t,n){"use strict";function r(){}function o(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function s(){this._events=new r,this._eventsCount=0}var i=Object.prototype.hasOwnProperty,u="~";Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(u=!1)),s.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)i.call(e,t)&&n.push(u?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},s.prototype.listeners=function(e,t){var n=u?u+e:e,r=this._events[n];if(t)return!!r;if(!r)return[];if(r.fn)return[r.fn];for(var o=0,s=r.length,i=new Array(s);o<s;o++)i[o]=r[o].fn;return i},s.prototype.emit=function(e,t,n,r,o,s){var i=u?u+e:e;if(!this._events[i])return!1;var a,h,c=this._events[i],l=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),l){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,r),!0;case 5:return c.fn.call(c.context,t,n,r,o),!0;case 6:return c.fn.call(c.context,t,n,r,o,s),!0}for(h=1,a=new Array(l-1);h<l;h++)a[h-1]=arguments[h];c.fn.apply(c.context,a)}else{var f,p=c.length;for(h=0;h<p;h++)switch(c[h].once&&this.removeListener(e,c[h].fn,void 0,!0),l){case 1:c[h].fn.call(c[h].context);break;case 2:c[h].fn.call(c[h].context,t);break;case 3:c[h].fn.call(c[h].context,t,n);break;case 4:c[h].fn.call(c[h].context,t,n,r);break;default:if(!a)for(f=1,a=new Array(l-1);f<l;f++)a[f-1]=arguments[f];c[h].fn.apply(c[h].context,a)}}return!0},s.prototype.on=function(e,t,n){var r=new o(t,n||this),s=u?u+e:e;return this._events[s]?this._events[s].fn?this._events[s]=[this._events[s],r]:this._events[s].push(r):(this._events[s]=r,this._eventsCount++),this},s.prototype.once=function(e,t,n){var r=new o(t,n||this,!0),s=u?u+e:e;return this._events[s]?this._events[s].fn?this._events[s]=[this._events[s],r]:this._events[s].push(r):(this._events[s]=r,this._eventsCount++),this},s.prototype.removeListener=function(e,t,n,o){var s=u?u+e:e;if(!this._events[s])return this;if(!t)return 0==--this._eventsCount?this._events=new r:delete this._events[s],this;var i=this._events[s];if(i.fn)i.fn!==t||o&&!i.once||n&&i.context!==n||(0==--this._eventsCount?this._events=new r:delete this._events[s]);else{for(var a=0,h=[],c=i.length;a<c;a++)(i[a].fn!==t||o&&!i[a].once||n&&i[a].context!==n)&&h.push(i[a]);h.length?this._events[s]=1===h.length?h[0]:h:0==--this._eventsCount?this._events=new r:delete this._events[s]}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=u?u+e:e,this._events[t]&&(0==--this._eventsCount?this._events=new r:delete this._events[t])):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prototype.setMaxListeners=function(){return this},s.prefixed=u,s.EventEmitter=s,e.exports=s},function(e,t,n){var r,o,s;!function(n,i){o=[t,e],r=i,void 0!==(s="function"==typeof r?r.apply(t,o):r)&&(e.exports=s)}(0,function(e,t){"use strict";function n(){return"jsonp_"+Date.now()+"_"+Math.ceil(1e5*Math.random())}function r(e){try{delete window[e]}catch(t){window[e]=void 0}}function o(e){var t=document.getElementById(e);document.getElementsByTagName("head")[0].removeChild(t)}function s(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],s=e,u=t.timeout||i.timeout,a=t.jsonpCallback||i.jsonpCallback,h=void 0;return new Promise(function(i,c){var l=t.jsonpCallbackFunction||n(),f=a+"_"+l;window[l]=function(e){i({ok:!0,json:function(){return Promise.resolve(e)}}),h&&clearTimeout(h),o(f),r(l)},s+=-1===s.indexOf("?")?"?":"&";var p=document.createElement("script");p.setAttribute("src",""+s+a+"="+l),t.charset&&p.setAttribute("charset",t.charset),p.id=f,document.getElementsByTagName("head")[0].appendChild(p),h=setTimeout(function(){c(new Error("JSONP request to "+e+" timed out")),r(l),o(f)},u)})}var i={timeout:5e3,jsonpCallback:"callback",jsonpCallbackFunction:null};t.exports=s})},function(e,t,n){(function(e,r){var o;!function(s){function i(e){throw new RangeError(T[e])}function u(e,t){for(var n=e.length,r=[];n--;)r[n]=t(e[n]);return r}function a(e,t){var n=e.split("@"),r="";return n.length>1&&(r=n[0]+"@",e=n[1]),e=e.replace(E,"."),r+u(e.split("."),t).join(".")}function h(e){for(var t,n,r=[],o=0,s=e.length;o<s;)t=e.charCodeAt(o++),t>=55296&&t<=56319&&o<s?(n=e.charCodeAt(o++),56320==(64512&n)?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),o--)):r.push(t);return r}function c(e){return u(e,function(e){var t="";return e>65535&&(e-=65536,t+=U(e>>>10&1023|55296),e=56320|1023&e),t+=U(e)}).join("")}function l(e){return e-48<10?e-22:e-65<26?e-65:e-97<26?e-97:w}function f(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function p(e,t,n){var r=0;for(e=n?R(e/O):e>>1,e+=R(e/t);e>D*j>>1;r+=w)e=R(e/D);return R(r+(D+1)*e/(e+x))}function d(e){var t,n,r,o,s,u,a,h,f,d,v=[],m=e.length,y=0,b=S,g=C;for(n=e.lastIndexOf(P),n<0&&(n=0),r=0;r<n;++r)e.charCodeAt(r)>=128&&i("not-basic"),v.push(e.charCodeAt(r));for(o=n>0?n+1:0;o<m;){for(s=y,u=1,a=w;o>=m&&i("invalid-input"),h=l(e.charCodeAt(o++)),(h>=w||h>R((_-y)/u))&&i("overflow"),y+=h*u,f=a<=g?k:a>=g+j?j:a-g,!(h<f);a+=w)d=w-f,u>R(_/d)&&i("overflow"),u*=d;t=v.length+1,g=p(y-s,t,0==s),R(y/t)>_-b&&i("overflow"),b+=R(y/t),y%=t,v.splice(y++,0,b)}return c(v)}function v(e){var t,n,r,o,s,u,a,c,l,d,v,m,y,b,g,x=[];for(e=h(e),m=e.length,t=S,n=0,s=C,u=0;u<m;++u)(v=e[u])<128&&x.push(U(v));for(r=o=x.length,o&&x.push(P);r<m;){for(a=_,u=0;u<m;++u)(v=e[u])>=t&&v<a&&(a=v);for(y=r+1,a-t>R((_-n)/y)&&i("overflow"),n+=(a-t)*y,t=a,u=0;u<m;++u)if(v=e[u],v<t&&++n>_&&i("overflow"),v==t){for(c=n,l=w;d=l<=s?k:l>=s+j?j:l-s,!(c<d);l+=w)g=c-d,b=w-d,x.push(U(f(d+g%b,0))),c=R(g/b);x.push(U(f(c,0))),s=p(n,y,r==o),n=0,++r}++n,++t}return x.join("")}function m(e){return a(e,function(e){return I.test(e)?d(e.slice(4).toLowerCase()):e})}function y(e){return a(e,function(e){return A.test(e)?"xn--"+v(e):e})}var b=("object"==typeof t&&t&&t.nodeType,"object"==typeof e&&e&&e.nodeType,"object"==typeof r&&r);var g,_=2147483647,w=36,k=1,j=26,x=38,O=700,C=72,S=128,P="-",I=/^xn--/,A=/[^\x20-\x7E]/,E=/[\x2E\u3002\uFF0E\uFF61]/g,T={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},D=w-k,R=Math.floor,U=String.fromCharCode;g={version:"1.4.1",ucs2:{decode:h,encode:c},decode:d,encode:v,toASCII:y,toUnicode:m},void 0!==(o=function(){return g}.call(t,n,t,e))&&(e.exports=o)}()}).call(t,n(16)(e),n(15))},function(e,t,n){"use strict";function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,t,n,s){t=t||"&",n=n||"=";var i={};if("string"!=typeof e||0===e.length)return i;var u=/\+/g;e=e.split(t);var a=1e3;s&&"number"==typeof s.maxKeys&&(a=s.maxKeys);var h=e.length;a>0&&h>a&&(h=a);for(var c=0;c<h;++c){var l,f,p,d,v=e[c].replace(u,"%20"),m=v.indexOf(n);m>=0?(l=v.substr(0,m),f=v.substr(m+1)):(l=v,f=""),p=decodeURIComponent(l),d=decodeURIComponent(f),r(i,p)?o(i[p])?i[p].push(d):i[p]=[i[p],d]:i[p]=d}return i};var o=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},function(e,t,n){"use strict";function r(e,t){if(e.map)return e.map(t);for(var n=[],r=0;r<e.length;r++)n.push(t(e[r],r));return n}var o=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,n,u){return t=t||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?r(i(e),function(i){var u=encodeURIComponent(o(i))+n;return s(e[i])?r(e[i],function(e){return u+encodeURIComponent(o(e))}).join(t):u+encodeURIComponent(o(e[i]))}).join(t):u?encodeURIComponent(o(u))+n+encodeURIComponent(o(e)):""};var s=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},i=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}},function(e,t,n){"use strict";t.decode=t.parse=n(10),t.encode=t.stringify=n(11)},function(e,t,n){"use strict";function r(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function o(e,t,n){if(e&&h.isObject(e)&&e instanceof r)return e;var o=new r;return o.parse(e,t,n),o}function s(e){return h.isString(e)&&(e=o(e)),e instanceof r?e.format():r.prototype.format.call(e)}function i(e,t){return o(e,!1,!0).resolve(t)}function u(e,t){return e?o(e,!1,!0).resolveObject(t):t}var a=n(9),h=n(14);t.parse=o,t.resolve=i,t.resolveObject=u,t.format=s,t.Url=r;var c=/^([a-z0-9.+-]+:)/i,l=/:[0-9]*$/,f=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,p=["<",">",'"',"`"," ","\r","\n","\t"],d=["{","}","|","\\","^","`"].concat(p),v=["'"].concat(d),m=["%","/","?",";","#"].concat(v),y=["/","?","#"],b=/^[+a-z0-9A-Z_-]{0,63}$/,g=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,_={javascript:!0,"javascript:":!0},w={javascript:!0,"javascript:":!0},k={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},j=n(12);r.prototype.parse=function(e,t,n){if(!h.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var r=e.indexOf("?"),o=-1!==r&&r<e.indexOf("#")?"?":"#",s=e.split(o),i=/\\/g;s[0]=s[0].replace(i,"/"),e=s.join(o);var u=e;if(u=u.trim(),!n&&1===e.split("#").length){var l=f.exec(u);if(l)return this.path=u,this.href=u,this.pathname=l[1],l[2]?(this.search=l[2],this.query=t?j.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var p=c.exec(u);if(p){p=p[0];var d=p.toLowerCase();this.protocol=d,u=u.substr(p.length)}if(n||p||u.match(/^\/\/[^@\/]+@[^@\/]+/)){var x="//"===u.substr(0,2);!x||p&&w[p]||(u=u.substr(2),this.slashes=!0)}if(!w[p]&&(x||p&&!k[p])){for(var O=-1,C=0;C<y.length;C++){var S=u.indexOf(y[C]);-1!==S&&(-1===O||S<O)&&(O=S)}var P,I;I=-1===O?u.lastIndexOf("@"):u.lastIndexOf("@",O),-1!==I&&(P=u.slice(0,I),u=u.slice(I+1),this.auth=decodeURIComponent(P)),O=-1;for(var C=0;C<m.length;C++){var S=u.indexOf(m[C]);-1!==S&&(-1===O||S<O)&&(O=S)}-1===O&&(O=u.length),this.host=u.slice(0,O),u=u.slice(O),this.parseHost(),this.hostname=this.hostname||"";var A="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!A)for(var E=this.hostname.split(/\./),C=0,T=E.length;C<T;C++){var D=E[C];if(D&&!D.match(b)){for(var R="",U=0,q=D.length;U<q;U++)D.charCodeAt(U)>127?R+="x":R+=D[U];if(!R.match(b)){var N=E.slice(0,C),L=E.slice(C+1),M=D.match(g);M&&(N.push(M[1]),L.unshift(M[2])),L.length&&(u="/"+L.join(".")+u),this.hostname=N.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),A||(this.hostname=a.toASCII(this.hostname));var B=this.port?":"+this.port:"",z=this.hostname||"";this.host=z+B,this.href+=this.host,A&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==u[0]&&(u="/"+u))}if(!_[d])for(var C=0,T=v.length;C<T;C++){var F=v[C];if(-1!==u.indexOf(F)){var $=encodeURIComponent(F);$===F&&($=escape(F)),u=u.split(F).join($)}}var J=u.indexOf("#");-1!==J&&(this.hash=u.substr(J),u=u.slice(0,J));var H=u.indexOf("?");if(-1!==H?(this.search=u.substr(H),this.query=u.substr(H+1),t&&(this.query=j.parse(this.query)),u=u.slice(0,H)):t&&(this.search="",this.query={}),u&&(this.pathname=u),k[d]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var B=this.pathname||"",K=this.search||"";this.path=B+K}return this.href=this.format(),this},r.prototype.format=function(){var e=this.auth||"";e&&(e=encodeURIComponent(e),e=e.replace(/%3A/i,":"),e+="@");var t=this.protocol||"",n=this.pathname||"",r=this.hash||"",o=!1,s="";this.host?o=e+this.host:this.hostname&&(o=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&h.isObject(this.query)&&Object.keys(this.query).length&&(s=j.stringify(this.query));var i=this.search||s&&"?"+s||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||k[t])&&!1!==o?(o="//"+(o||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):o||(o=""),r&&"#"!==r.charAt(0)&&(r="#"+r),i&&"?"!==i.charAt(0)&&(i="?"+i),n=n.replace(/[?#]/g,function(e){return encodeURIComponent(e)}),i=i.replace("#","%23"),t+o+n+i+r},r.prototype.resolve=function(e){return this.resolveObject(o(e,!1,!0)).format()},r.prototype.resolveObject=function(e){if(h.isString(e)){var t=new r;t.parse(e,!1,!0),e=t}for(var n=new r,o=Object.keys(this),s=0;s<o.length;s++){var i=o[s];n[i]=this[i]}if(n.hash=e.hash,""===e.href)return n.href=n.format(),n;if(e.slashes&&!e.protocol){for(var u=Object.keys(e),a=0;a<u.length;a++){var c=u[a];"protocol"!==c&&(n[c]=e[c])}return k[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(e.protocol&&e.protocol!==n.protocol){if(!k[e.protocol]){for(var l=Object.keys(e),f=0;f<l.length;f++){var p=l[f];n[p]=e[p]}return n.href=n.format(),n}if(n.protocol=e.protocol,e.host||w[e.protocol])n.pathname=e.pathname;else{for(var d=(e.pathname||"").split("/");d.length&&!(e.host=d.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==d[0]&&d.unshift(""),d.length<2&&d.unshift(""),n.pathname=d.join("/")}if(n.search=e.search,n.query=e.query,n.host=e.host||"",n.auth=e.auth,n.hostname=e.hostname||e.host,n.port=e.port,n.pathname||n.search){var v=n.pathname||"",m=n.search||"";n.path=v+m}return n.slashes=n.slashes||e.slashes,n.href=n.format(),n}var y=n.pathname&&"/"===n.pathname.charAt(0),b=e.host||e.pathname&&"/"===e.pathname.charAt(0),g=b||y||n.host&&e.pathname,_=g,j=n.pathname&&n.pathname.split("/")||[],d=e.pathname&&e.pathname.split("/")||[],x=n.protocol&&!k[n.protocol];if(x&&(n.hostname="",n.port=null,n.host&&(""===j[0]?j[0]=n.host:j.unshift(n.host)),n.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===d[0]?d[0]=e.host:d.unshift(e.host)),e.host=null),g=g&&(""===d[0]||""===j[0])),b)n.host=e.host||""===e.host?e.host:n.host,n.hostname=e.hostname||""===e.hostname?e.hostname:n.hostname,n.search=e.search,n.query=e.query,j=d;else if(d.length)j||(j=[]),j.pop(),j=j.concat(d),n.search=e.search,n.query=e.query;else if(!h.isNullOrUndefined(e.search)){if(x){n.hostname=n.host=j.shift();var O=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@");O&&(n.auth=O.shift(),n.host=n.hostname=O.shift())}return n.search=e.search,n.query=e.query,h.isNull(n.pathname)&&h.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n}if(!j.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var C=j.slice(-1)[0],S=(n.host||e.host||j.length>1)&&("."===C||".."===C)||""===C,P=0,I=j.length;I>=0;I--)C=j[I],"."===C?j.splice(I,1):".."===C?(j.splice(I,1),P++):P&&(j.splice(I,1),P--);if(!g&&!_)for(;P--;P)j.unshift("..");!g||""===j[0]||j[0]&&"/"===j[0].charAt(0)||j.unshift(""),S&&"/"!==j.join("/").substr(-1)&&j.push("");var A=""===j[0]||j[0]&&"/"===j[0].charAt(0);if(x){n.hostname=n.host=A?"":j.length?j.shift():"";var O=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@");O&&(n.auth=O.shift(),n.host=n.hostname=O.shift())}return g=g||n.host&&j.length,g&&!A&&j.unshift(""),j.length?n.pathname=j.join("/"):(n.pathname=null,n.path=null),h.isNull(n.pathname)&&h.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=e.auth||n.auth,n.slashes=n.slashes||e.slashes,n.href=n.format(),n},r.prototype.parseHost=function(){var e=this.host,t=l.exec(e);t&&(t=t[0],":"!==t&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},function(e,t,n){"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t){e.exports={name:"schibsted-browser-sdk",version:"0.0.5",description:"Browser SDK for Schibsted Identity and Payment",keywords:["schibsted","identity","payment","oauth"],license:"MIT",main:"index.js",browser:"dist/bundle.js",scripts:{lint:"eslint .",test:"mocha -r jsdom-global/register --compilers js:babel-core/register --recursive test",docs:"eslint . && rm -rf docs && jsdoc -c ./jsdoc.json",preversion:"npm run lint && npm test && npm run docs && travis lint",version:"npm run build-prod && git add dist",postversion:"git push && git push --tags","build-prod":"webpack --optimize-minimize --displayModules --display-reasons --sort-modules-by size",build:"webpack --displayModules --display-reasons --sort-modules-by size"},dependencies:{"browser-cookies":"^1.1.0",eventemitter3:"^2.0.3","fetch-jsonp":"^1.0.6",querystring:"^0.2.0"},devDependencies:{"babel-core":"^6.24.1","babel-loader":"^7.0.0","babel-preset-es2015":"^6.24.1",chai:"^4.0.0",eslint:"^3.19.0","eslint-config-schibsted":"^3.1.0","eslint-plugin-import":"^2.2.0",jsdoc:"^3.4.3",jsdom:"^11.0.0","jsdom-global":"^3.0.2",mocha:"^3.3.0",webpack:"^2.5.1"},repository:{type:"git",url:"https://github.com/schibsted/browser-sdk"},bugs:{url:"https://github.com/schibsted/browser-sdk/issues"}}}])});